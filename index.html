<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Favicon and App Icons -->
  <link rel="apple-touch-icon" sizes="57x57" href="/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/favicon-144x144.png">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ffffff">

  <!-- iOS Web App Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="M3U Generator">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- General Meta -->
  <title>Create M3U Playlists from Internet Archive & Live Music Archive</title>
  <meta name="description"
    content="Create M3U playlists from Internet Archive concerts and Live Music Archive recordings. Stream or download MP3, FLAC, or OGG with one click.">
  <meta name="keywords"
    content="m3u playlist generator, create m3u for internet archive, live music archive m3u, flac playlist builder, internet archive audio player, archive.org playlist">

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="M3U Playlist Generator for Internet Archive">
  <meta property="og:description"
    content="Instantly create and download M3U playlists for concerts and recordings on the Internet Archive. Supports MP3, FLAC, OGG with previews.">
  <meta property="og:url" content="https://archivetom3u.com/">
  <meta property="og:image" content="/favicon-512x512.png">
  <meta property="og:type" content="website">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="M3U Generator for Internet Archive">
  <meta name="twitter:description"
    content="Generate M3U playlists from Internet Archive shows and recordings. Select audio format, preview, and download in seconds.">
  <meta name="twitter:image" content="/favicon-512x512.png">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta charset="UTF-8" />
  <title>Create M3U Playlists from Internet Archive & Live Music Archive</title>
  <meta name="description"
    content="Generate M3U playlists from Internet Archive concerts and Live Music Archive recordings. Stream or download MP3, FLAC, and OGG tracks with previews.">
  <meta name="keywords"
    content="m3u playlist generator, create m3u for internet archive, live music archive m3u, flac playlist builder, internet archive audio player, archive.org playlist">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body {
      padding-top: 60px;
    }

    .m3u-block {
      white-space: pre-wrap;
      background: #f8f9fa;
      padding: 1em;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .track {
      margin-bottom: 1rem;
    }

    audio {
      width: 100%;
      margin-top: 0.5rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 class="mb-4 text-center">Internet Archive M3U Playlist Builder</h1>

    <div class="bg-white border rounded p-3 small text-muted text-start mt-5 description-paragraphs">

      <p class="mb-2">
        <strong>
          <i class="bi bi-info-circle-fill me-1"></i> About this tool:
        </strong><br>
        This free browser-based utility allows you to instantly generate and download M3U playlists
        from <a href="https://archive.org" target="_blank">Internet Archive</a> items, including the <a
          href="https://archive.org/details/etree" target="_blank">Live
          Music Archive</a>.
        Just paste a valid item URL, select your preferred audio format (MP3, FLAC, OGG, etc.), and get a
        fully structured M3U file for streaming with one click.
      </p><br>

      <p class="mb-2"><strong><i class="bi bi-check-circle-fill"></i> Supported Formats:</strong><br>
        &ndash; VBR MP3<br>
        &ndash; FLAC<br>
        &ndash; 24BIT FLAC<br>
        &ndash; OGG VORBIS<br>
        Only tracks available in your selected format will be included in the generated playlist.
      </p><br>

      <p class="mb-2"><strong><i class="bi bi-lightning-charge-fill"></i> How It Works:</strong><br>
        This tool connects directly to the <a href="https://archive.org" target="_blank">Internet Archive</a> metadata
        API. No content is hosted or mirrored by this site. It simply fetches publicly available metadata and builds an
        M3U playlist based on your selection.
        You can also preview each track with an inline audio player.
      </p><br>

      <p class="mb-2"><strong><i class="bi bi-arrow-down-circle-fill"></i> Downloading:</strong><br>
        Once generated, your playlist can be downloaded as a standard <code>.m3u</code> file compatible with most audio
        players. No account, login, or software installation is required.
      </p><br>

      <p class="mb-2"><strong><i class="bi bi-shield-lock-fill"></i> Privacy:</strong><br>
        All processing happens in your browser. This site does not store or track any user input, playback history, or
        downloaded files. Your data stays private and never leaves your device.
      </p><br>

      <p class="mb-2"><strong><i class="bi bi-github"></i> Contribute on GitHub:</strong><br>
        This tool is open-source! If you'd like to improve it, report bugs, or suggest features, visit the project
        page:<br>
        <a href="https://github.com/everappz/archivetom3u" target="_blank" class="text-decoration-none">
          https://github.com/everappz/archivetom3u
        </a>
      </p>

      <hr class="my-3">

      <p class="mb-2"><strong><i class="bi bi-exclamation-triangle-fill text-warning"></i> Disclaimer:</strong><br>
        This site is an independent interface built for convenience and educational purposes only. It is not affiliated
        with or endorsed by the Internet Archive.<br>
        All audio content and media links are streamed directly from <a href="https://archive.org"
          target="_blank">archive.org</a>, and usage is subject to their official <a
          href="https://archive.org/about/terms.php" target="_blank">Terms of Use</a>.<br>
        No warranties are provided. Use at your own risk and ensure compliance with any copyright, licensing, or usage
        policies associated with the content.
      </p>
    </div>

    <div class="my-3">
      <label for="archiveUrl" class="form-label">Enter Internet Archive Item URL</label>
      <input type="text" class="form-control" id="archiveUrl" placeholder="https://archive.org/details/..." />
    </div>

    <div class="mb-3">
      <label for="formatSelect" class="form-label">Select Audio Format</label>
      <select class="form-select" id="formatSelect">
        <option value="VBR MP3" selected>VBR MP3</option>
        <option value="Flac">FLAC</option>
        <option value="24bit Flac">24BIT FLAC</option>
        <option value="OGG VORBIS">OGG VORBIS</option>
      </select>
    </div>

    <div class="d-grid gap-3">
      <button class="btn btn-primary" onclick="generateM3U()">
        <i class="bi bi-music-note-list me-1"></i> Generate Playlist
      </button>

      <a id="downloadBtn" class="btn btn-success d-none" download="playlist.m3u">
        <i class="bi bi-download me-1"></i> Download M3U
      </a>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingIndicator" class="text-center my-4 d-none">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Error Alert -->
    <div id="errorAlert" class="alert alert-danger my-4 d-none" role="alert"></div>

    <!-- M3U Output Section -->
    <div id="outputSection" class="mt-4 d-none">
      <h5 class="d-flex align-items-center justify-content-between">
        <span>M3U Playlist Output</span>
        <i class="bi bi-clipboard text-secondary" id="copyM3U" style="cursor:pointer;" title="Copy to clipboard"></i>
      </h5>
      <div id="result" class="m3u-block"></div>
    </div>

    <!-- Preview Section -->
    <div id="previewSection" class="mt-4 d-none">
      <h5>Track Previews</h5>
      <div id="trackList" class="m3u-block"></div>
    </div>

    <footer class="text-center mt-5 text-muted small">
      <p class="mb-1 text-secondary">
        <a href="https://github.com/everappz/archivetom3u/edit/main/index.html" target="_blank"
          class="text-decoration-none text-secondary">
          Edit this page on GitHub →
        </a>
      </p>
      <p class="mt-3 mb-4 text-secondary">
        &copy; 2025 <a href="https://www.everappz.com/" target="_blank"
          class="text-decoration-none text-secondary">EVERAPPZ SL</a>
      </p>
    </footer>

  </div>

  <script>

    async function generateM3U(redirect = false) {
      const input = document.getElementById('archiveUrl').value.trim();
      const format = document.getElementById('formatSelect').value;
      const resultDiv = document.getElementById('result');
      const trackList = document.getElementById('trackList');
      const downloadBtn = document.getElementById('downloadBtn');
      const loading = document.getElementById('loadingIndicator');
      const errorAlert = document.getElementById('errorAlert');

      // Reset UI only if not redirect
      if (!redirect) {
        document.getElementById('outputSection').classList.add('d-none');
        document.getElementById('previewSection').classList.add('d-none');
        downloadBtn.classList.add('d-none');
        errorAlert.classList.add('d-none');
        loading.classList.remove('d-none');

        resultDiv.textContent = 'Loading...';
        trackList.innerHTML = '';
      }

      try {
        const identifier = input.match(/\/details\/([^/?#]+)/)?.[1];
        if (!identifier) throw new Error('Invalid Archive URL');

        const metadataUrl = `https://archive.org/metadata/${identifier}`;
        const res = await fetch(metadataUrl);
        if (!res.ok) throw new Error('Failed to fetch metadata');

        const data = await res.json();
        const files = data.files;
        const server = data.server || 'archive.org';
        const dir = data.dir;

        const matches = files.filter(file => file.format?.toUpperCase() === format.toUpperCase());
        if (matches.length === 0) throw new Error(`No files found for format: ${format}`);

        let m3u = `#EXTM3U\n`;

        matches.forEach((file, index) => {
          const title = file.title || file.name;
          const duration = parseDuration(file.length);
          const fileUrl = `https://${server}${dir}/${file.name}`;
          m3u += `#EXTINF:${duration},${title}\n${fileUrl}\n`;

          if (!redirect) {
            const trackEl = document.createElement('div');
            trackEl.classList.add('track');
            trackEl.innerHTML = `${index + 1}. <strong>${title}</strong><br><audio controls src="${fileUrl}"></audio>`;
            trackList.appendChild(trackEl);
          }
        });

        const blob = new Blob([m3u], { type: 'audio/x-mpegurl' });
        const blobUrl = URL.createObjectURL(blob);

        if (redirect) {
          const a = document.createElement('a');
          a.href = blobUrl;
          a.download = `${identifier}.m3u`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          return;
        }

        resultDiv.textContent = m3u;
        downloadBtn.href = blobUrl;
        downloadBtn.setAttribute('download', `${identifier}.m3u`);
        downloadBtn.classList.remove('d-none');
        document.getElementById('outputSection').classList.remove('d-none');
        document.getElementById('previewSection').classList.remove('d-none');

      } catch (err) {
        errorAlert.textContent = '⚠️ ' + err.message;
        errorAlert.classList.remove('d-none');
        resultDiv.textContent = '';
      } finally {
        if (!redirect) {
          loading.classList.add('d-none');
        }
      }
    }

    function parseDuration(str) {
      if (!str) return -1;
      const parts = str.split(':').map(Number);
      if (parts.length === 3) return parts[0] * 3600 + parts[1] * 60 + parts[2];
      if (parts.length === 2) return parts[0] * 60 + parts[1];
      return Math.floor(Number(str)) || -1;
    }

    document.getElementById('copyM3U').addEventListener('click', () => {
      const content = document.getElementById('result').textContent;
      if (!content.trim()) return;

      navigator.clipboard.writeText(content).then(() => {
        const icon = document.getElementById('copyM3U');
        icon.classList.replace('bi-clipboard', 'bi-clipboard-check');
        icon.classList.replace('text-secondary', 'text-success');
        icon.title = 'Copied!';
        setTimeout(() => {
          icon.classList.replace('bi-clipboard-check', 'bi-clipboard');
          icon.classList.replace('text-success', 'text-secondary');
          icon.title = 'Copy to clipboard';
        }, 2000);
      });
    });

    // Handle exclusive audio playback
    document.addEventListener('play', function (e) {
      const audios = document.querySelectorAll('audio');
      for (const audio of audios) {
        if (audio !== e.target) {
          audio.pause();
        }
      }
    }, true);


    window.addEventListener('DOMContentLoaded', () => {
      const match = window.location.pathname.match(/^\/details\/(.+)/);
      if (match) {
        const identifier = match[1];
        const archiveUrl = `https://archive.org/details/${identifier}`;
        document.getElementById('archiveUrl').value = archiveUrl;
        document.getElementById('formatSelect').value = 'VBR MP3';
        generateM3U(true); // automatic + redirect
      }
    });

  </script>
</body>

</html>